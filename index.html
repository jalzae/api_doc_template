<html>

<head>
  <title>API Document</title>
  <meta charset="UTF-8">
  <link rel="stylesheet" type="text/css" href="./bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="./swagger-ui.css">
  <link rel="stylesheet" type="text/css" href="./custom-swagger-ui.css">
  <link rel="stylesheet" href="./prism.css">
  <script src="./prism.js"></script>
  <link rel="stylesheet" href="./style.css">

</head>

<body>
  <ul class="nav nav-tabs" id="tabMenu">
    <li class="nav-item">
      <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home">Home</a>
    </li>
  </ul>
  <div class="tab-content" id="tabContent" class="col-md-12">
    <div class="tab-pane fade show active" id="home">
      <!-- Home content goes here -->
      <nav class="navbar navbar-expand-md navbar-light bg-light">
        <a style="padding-left: 18px;" class="navbar-brand d-flex align-items-center" href="#">
          <img src="./logo.png" style="max-width: 40px; height: auto;" class="logo me-2">
        </a>


        <!-- Search Bar or Burger Menu -->
        <form class="form-inline my-2 my-md-0" style="padding-right:12px;">
          <input id="searchInput" class="form-control" type="search" onkeyup="filterAPI();" placeholder="Search"
            aria-label="Search">
        </form>
      </nav>

      <div class="col-md-12 d-flex">
        <div class="col-md-8">
          <div id="swagger-ui"></div>
        </div>
        <div id="sidebar" class="col-md-4 hidden">
          <div class="content">
            <h2>Details</h2>
            <div class="code-preview">
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- Include Bootstrap JS and jQuery -->
  <script src="./jquery-3.5.1.slim.min.js"></script>
  <script src="./bootstrap.min.js"></script>
  <script src="./swagger-ui-bundle.js"> </script>
  <script src="./swagger-ui-standalone-preset.js"> </script>
  <script src="./data.js"> </script>

  <script>


    function reInit(spec) {
      const ui = SwaggerUIBundle({
        spec: spec,
        dom_id: '#swagger-ui',
        deepLinking: true,
        presets: [
          SwaggerUIBundle.presets.apis,
          SwaggerUIStandalonePreset
        ],
        plugins: [
          SwaggerUIBundle.plugins.DownloadUrl
        ],
        layout: "StandaloneLayout"
      })
      window.ui = ui
    }

    function filterAPI() {
      var searchInput = document.getElementById("searchInput").value.toLowerCase();
      if (searchInput == "") {
        reInit(spec)
        return false
      }

      var paths = {}
      for (var path in spec.paths) {
        if (path.toLowerCase().includes(searchInput)) {
          var pathData = spec.paths[path];

          paths[path] = pathData;
        }
      }

      var newSpec = {
        openapi: "3.0.1",
        info: {
          "title": "Result Search.."
        },
        paths: paths
      }

      reInit(newSpec)
    }

    function addMenuTabs() {
      const tabMenu = document.getElementById('tabMenu');
      const tabContent = document.getElementById('tabContent');
      const menu = spec.menu

      for (const key in menu) {
        const value = menu[key];
        tabMenu.innerHTML += `<li class="nav-item">
      <a class="nav-link" id="${key}-tab" data-toggle="tab" href="#${key}">${key.toUpperCase()}</a>
    </li>`

        tabContent.innerHTML += `<div class="tab-pane fade" id="${key}">
${value}
    </div>`
      }


    }

    window.onload = () => {
      reInit(spec);

      const sidebarElement = document.getElementById('sidebar');
      const opblockElements = document.getElementsByClassName('opblock');
      const previewCode = document.querySelector('.code-preview');

      for (let i = 0; i < opblockElements.length; i++) {
        opblockElements[i].addEventListener('click', function () {
          const completeId = opblockElements[i].id;
          console.log(completeId)
          sidebarElement.classList.remove('hidden');
          const pathElement = document.querySelector('#' + completeId + ' .opblock-summary-path a.nostyle span');
          const methodElement = document.querySelector('#' + completeId + ' .opblock-summary-method');
          const method = methodElement.textContent.trim().toLowerCase();
          const path = pathElement.textContent;
          var e = spec.paths[path][method].responses
          var code = spec.paths[path][method].code

          var count = 0;
          previewCode.innerHTML = ''
          previewCode.innerHTML += `<pre><code><p>${method} : ${path}</p></code></pre>`
          if (code) {
            previewCode.innerHTML += `<h3>Code</h3>
            <pre>
                <code class="language-javascript">
                  ${code}
                </code>
            </pre>
            `

          }
          for (const responseCode in e) {
            if (e[responseCode].expected) {
              previewCode.innerHTML += `
              
              <h3>${responseCode}</h3>
              <pre>
                <code class="language-javascript">
${e[responseCode].expected}
              </code>
              </pre>`
              count++
            }
          }

          if (count == 0) {
            sidebarElement.classList.add('hidden');
          }
        });
      }
    };

    addMenuTabs()
  </script>
</body>

</html>